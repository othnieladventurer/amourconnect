{% extends 'nmdashboard/base.html' %}

{% block content %}

<main class="flex justify-center pt-28 px-4">
  <div class="w-full max-w-md flex flex-col h-[80vh]">
    
    <!-- Chat Header -->
    <div class="bg-white rounded-t-2xl shadow p-4 flex items-center gap-3">
      {% if other_user.profile_photo %}
        <img src="{{ other_user.profile_photo.url }}" class="w-12 h-12 rounded-full object-cover">
      {% else %}
        <img src="/static/images/default-profile.png" class="w-12 h-12 rounded-full object-cover">
      {% endif %}
      <div>
        <h2 class="font-bold text-lg">{{ other_user.username }}</h2>
        <p class="text-sm text-gray-500">Matché avec vous</p>
      </div>
    </div>

    <!-- Chat Messages -->
    <div id="messages-container" class="flex-1 overflow-y-auto p-4 bg-gray-50 space-y-3">
      {% if messages %}
        {% for msg in messages %}
          <div class="flex {% if msg.sender == user %}justify-end{% else %}justify-start{% endif %}">
            <div class="px-4 py-2 rounded-xl max-w-xs break-words
                        {% if msg.sender == user %}bg-secondary text-white{% else %}bg-white border{% endif %}">
              {{ msg.content }}
              <span class="block text-xs text-gray-400 mt-1 text-right">{{ msg.timestamp|date:"H:i" }}</span>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-gray-400 text-center mt-10">Aucun message pour le moment. Envoyez votre premier message !</p>
      {% endif %}
    </div>

    <!-- Message Input -->
    <form method="POST" class="flex p-4 gap-2 bg-white rounded-b-2xl shadow">
      {% csrf_token %}
      <input type="text" name="content" placeholder="Écrivez votre message..."
             class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-secondaryLight focus:border-secondary" required>
      <button type="submit" class="bg-secondary text-white px-4 py-2 rounded-full hover:opacity-90 transition">Envoyer</button>
    </form>

  </div>
</main>

<!-- Auto-scroll to bottom -->
<script>
  const messagesContainer = document.getElementById("messages-container");
  if (messagesContainer) {
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }
</script>

{% endblock content %}
